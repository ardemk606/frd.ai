# üöÄ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞ FRDA

–≠—Ç–æ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å—É–ø–µ—Ä-–±—ã—Å—Ç—Ä–æ–π —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ FRDA –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º Docker —Å–ª–æ–µ–≤.

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

**–ë—ã–ª–æ**: PyTorch –∏ –¥—Ä—É–≥–∏–µ ML-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞, —á—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç 10-15 –º–∏–Ω—É—Ç.

**–°—Ç–∞–ª–æ**: ML-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∫–µ—à–∏—Ä—É—é—Ç—Å—è –∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `requirements.txt`.

## üìÅ –§–∞–π–ª—ã

### `build-optimized.sh` (Linux/macOS)
```bash
./scripts/build-optimized.sh                # –°–±–æ—Ä–∫–∞ CPU worker
./scripts/build-optimized.sh --with-gpu     # –°–±–æ—Ä–∫–∞ CPU + GPU worker
```

### `build-optimized.bat` (Windows)
```cmd
scripts\build-optimized.bat                 # –°–±–æ—Ä–∫–∞ CPU worker
scripts\build-optimized.bat --with-gpu      # –°–±–æ—Ä–∫–∞ CPU + GPU worker
```

## üî• –í–∞—Ä–∏–∞–Ω—Ç—ã Dockerfile

### 1. `worker/Dockerfile` - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ—è —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ**: 3-5x –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Å–±–æ—Ä–∫–∞—Ö

### 2. `worker/Dockerfile.uv` - –£–ª—å—Ç—Ä–∞-–±—ã—Å—Ç—Ä—ã–π —Å UV
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç UV –≤–º–µ—Å—Ç–æ pip (–≤ 10-20x –±—ã—Å—Ç—Ä–µ–µ)
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–∞–∫–µ—Ç–æ–≤
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ**: 10-20x –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### 3. `worker/Dockerfile.optimized` - Multi-stage —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –ú–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω–∞—è —Å–±–æ—Ä–∫–∞
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ**: 5-10x –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Å–±–æ—Ä–∫–∞—Ö

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ Docker —Å–ª–æ–µ–≤**
```dockerfile
# ‚ùå –ü–ª–æ—Ö–æ - –Ω–∞—Ä—É—à–∞–µ—Ç –∫–µ—à –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞
COPY . .
RUN pip install -r requirements.txt

# ‚úÖ –•–æ—Ä–æ—à–æ - –∫–µ—à —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
```

### 2. **UV –≤–º–µ—Å—Ç–æ pip**
```dockerfile
# ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–æ
RUN pip install -r requirements.txt

# ‚úÖ –í 10x –±—ã—Å—Ç—Ä–µ–µ
RUN uv pip install -r requirements.txt
```

### 3. **Multi-stage build**
```dockerfile
FROM base as dependencies
RUN install_deps...

FROM dependencies as final
COPY code...
```

### 4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π requirements.txt**
```txt
# –°–Ω–∞—á–∞–ª–∞ —Ç—è–∂–µ–ª—ã–µ ML-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (—Ä–µ–¥–∫–æ –º–µ–Ω—è—é—Ç—Å—è)
torch
transformers
datasets

# –ü–æ—Ç–æ–º –ª–µ–≥–∫–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ (–º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å—Å—è)
fastapi
celery
```

## üìä –ó–∞–º–µ—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç–æ–¥ | –ü–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞ | –ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Å–±–æ—Ä–∫–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ deps |
|-------|---------------|------------------|----------------|----------------|
| –°—Ç–∞—Ä—ã–π pip | 15 –º–∏–Ω | 15 –º–∏–Ω | 15 –º–∏–Ω | 15 –º–∏–Ω |
| –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ | 15 –º–∏–Ω | 2 –º–∏–Ω | 2 –º–∏–Ω | 15 –º–∏–Ω |
| + UV | 3 –º–∏–Ω | 30 —Å–µ–∫ | 30 —Å–µ–∫ | 3 –º–∏–Ω |
| + Multi-stage | 3 –º–∏–Ω | 10 —Å–µ–∫ | 10 —Å–µ–∫ | 3 –º–∏–Ω |

## üéÆ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
```bash
# Linux/macOS
./scripts/build-optimized.sh

# Windows
scripts\build-optimized.bat
```

### –° GPU –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
```bash
# Linux/macOS
./scripts/build-optimized.sh --with-gpu

# Windows
scripts\build-optimized.bat --with-gpu
```

### –†—É—á–Ω–∞—è —Å–±–æ—Ä–∫–∞
```bash
# –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ (–∫–µ—à–∏—Ä—É–µ—Ç—Å—è)
docker build --target dependencies --tag frda-worker-deps .

# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
docker-compose build cpu-worker

# –ó–∞–ø—É—Å–∫
docker-compose up -d
```

## üõ†Ô∏è –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—Ä–∞–∑—ã
docker images | grep frda

# –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–æ–≤
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞
docker system df
```

### –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
```bash
# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã
docker system prune -a

# –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–±—Ä–∞–∑
docker rmi frda-worker-deps:latest
```

## üí° –°–æ–≤–µ—Ç—ã

1. **–ù–µ –º–µ–Ω—è–π—Ç–µ `requirements.txt` –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏** - —ç—Ç–æ —Å–±—Ä–æ—Å–∏—Ç –∫–µ—à
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.dockerignore`** –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
3. **–ó–∞–ø—É—Å–∫–∞–π—Ç–µ `docker system prune`** –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
4. **–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∫–µ—à–µ–º** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--no-cache`

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ –ø—Ä–æ–µ–∫—Ç

–ß—Ç–æ–±—ã –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç:

1. –ò–∑–º–µ–Ω–∏—Ç–µ –ø—É—Ç–∏ –≤ `docker-compose.yml`
2. –û–±–Ω–æ–≤–∏—Ç–µ `requirements.txt` –ø–æ–¥ —Å–≤–æ–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. –î–æ–±–∞–≤—å—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–¢–µ–ø–µ—Ä—å —Å–±–æ—Ä–∫–∞ –∑–∞–π–º–µ—Ç —Å–µ–∫—É–Ω–¥—ã –≤–º–µ—Å—Ç–æ –º–∏–Ω—É—Ç! üöÄ 